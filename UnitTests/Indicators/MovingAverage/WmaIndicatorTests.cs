// ********************************************************
// Copyright (C) 2021 Louis S. Berman (louis@squideyes.com)
//
// This file is part of SquidEyes.Trading
//
// The use of this source code is licensed under the terms
// of the MIT License (https://opensource.org/licenses/MIT)
// ********************************************************

using FluentAssertions;
using SquidEyes.Trading.Context;
using SquidEyes.Trading.Indicators;
using SquidEyes.UnitTests.Testing;
using Xunit;

namespace SquidEyes.UnitTests.Indicators;

public class WmaIndicatorTests
{
    [Fact]
    public void WmaIndicatorBaseline()
    {
        var results = new double[]
        {
            1.11663997, 1.11655335, 1.11644167, 1.11629702, 1.11622471, 1.11618624,
            1.11615720, 1.11616225, 1.11615580, 1.11614746, 1.11612708, 1.11609091,
            1.11607908, 1.11613418, 1.11618364, 1.11627291, 1.11633764, 1.11642799,
            1.11648982, 1.11652399, 1.11655928, 1.11655835, 1.11649600, 1.11641346,
            1.11639328, 1.11642438, 1.11640983, 1.11642728, 1.11646820, 1.11651783,
            1.11656438, 1.11657965, 1.11662747, 1.11665548, 1.11664275, 1.11659419,
            1.11656727, 1.11652671, 1.11647126, 1.11642472, 1.11639692, 1.11637402,
            1.11633512, 1.11629838, 1.11628185, 1.11626694, 1.11624894, 1.11625003,
            1.11627110, 1.11629765, 1.11630183, 1.11630674, 1.11632856, 1.11639274,
            1.11645038, 1.11648056, 1.11651584, 1.11654911, 1.11655403, 1.11656184,
            1.11660365, 1.11663746, 1.11666327, 1.11670999, 1.11677218, 1.11683346,
            1.11689492, 1.11689311, 1.11688492, 1.11687763, 1.11687126, 1.11681799,
            1.11675508, 1.11671109, 1.11666000, 1.11662872, 1.11657672, 1.11652236,
            1.11647619, 1.11642691, 1.11638709, 1.11634089, 1.11631998, 1.11632854,
            1.11634362, 1.11634908, 1.11636344, 1.11638145, 1.11640125, 1.11641706,
            1.11640980, 1.11640327, 1.11638291, 1.11633709, 1.11630544, 1.11628563,
            1.11626308, 1.11621345, 1.11613472, 1.11604906, 1.11599633, 1.11598887,
            1.11598871, 1.11594908, 1.11592817, 1.11595107, 1.11597651, 1.11600035,
            1.11606527, 1.11611073, 1.11613599, 1.11613326, 1.11620471, 1.11623762,
            1.11627253, 1.11630236, 1.11634872, 1.11638945, 1.11643673, 1.11645509,
            1.11647672, 1.11651253, 1.11649834, 1.11653289, 1.11661925, 1.11663999,
            1.11666452, 1.11669233, 1.11674470, 1.11684015, 1.11695507, 1.11714325,
            1.11734143, 1.11747143, 1.11757817, 1.11767126, 1.11771416, 1.11778162,
            1.11784653, 1.11799725, 1.11818087, 1.11834214, 1.11846394, 1.11866249,
            1.11881394, 1.11890375, 1.11904665, 1.11917230, 1.11934703, 1.11942847,
            1.11942395, 1.11950413, 1.11953141, 1.11956030, 1.11959121, 1.11961048,
            1.11966394, 1.11976540, 1.11987430, 1.11990920, 1.11995466, 1.12002592,
            1.12013538, 1.12017991, 1.12019846, 1.12022955, 1.12027974, 1.12029591,
            1.12025519, 1.12018137, 1.12009883, 1.12001027, 1.11993172, 1.11988790,
            1.11984482, 1.11977811, 1.11976393, 1.11975957, 1.11974647, 1.11975920,
            1.11979919, 1.11979538, 1.11971974, 1.11966300, 1.11962775, 1.11961175,
            1.11961410, 1.11965884, 1.11971811, 1.11973757, 1.11976992, 1.11978393,
            1.11981574, 1.11979465, 1.11974992, 1.11971774, 1.11965284, 1.11960394,
            1.11955395, 1.11944176, 1.11933485, 1.11920449, 1.11905811, 1.11889193,
            1.11878956, 1.11871592, 1.11866392, 1.11860630, 1.11852792, 1.11855356,
            1.11859484, 1.11858248, 1.11853812, 1.11852194, 1.11856723, 1.11862249,
            1.11861105, 1.11857578, 1.11849176, 1.11850212, 1.11849340, 1.11850703,
            1.11853394, 1.11855630, 1.11857448, 1.11859484, 1.11862066, 1.11865284,
            1.11868430, 1.11876031, 1.11885706, 1.11899306, 1.11910288, 1.11916706,
            1.11920344, 1.11924816, 1.11925400, 1.11924928, 1.11924783, 1.11929275,
            1.11930420, 1.11931493, 1.11933728, 1.11935856, 1.11941218, 1.11945126,
            1.11948562, 1.11952161, 1.11956906, 1.11958887, 1.11955924, 1.11949688,
            1.11944162, 1.11940124, 1.11934543, 1.11927216, 1.11921779, 1.11919415,
            1.11911999, 1.11905764, 1.11900020, 1.11897474, 1.11894129, 1.11896330,
            1.11898239, 1.11898275, 1.11898747, 1.11901165, 1.11902657, 1.11903475,
            1.11904893, 1.11904365, 1.11904438, 1.11904548, 1.11908420, 1.11914002,
            1.11917984, 1.11922675, 1.11927039, 1.11930221, 1.11932602, 1.11936476,
            1.11940403, 1.11943638, 1.11947655, 1.11955020, 1.11960075, 1.11963784
        };

        var indicator = new WmaIndicator(
            10, Known.Pairs[Symbol.EURUSD], RateToUse.Close);

        var candles = IndicatorData.GetCandles();

        candles.Count.Should().Be(results.Length);

        for (var i = 0; i < candles.Count; i++)
        {
            indicator.AddAndCalc(candles[i]).Value
                .Should().BeApproximately(results[i], 8);
        }
    }
}