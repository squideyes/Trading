// ********************************************************
// Copyright (C) 2021 Louis S. Berman (louis@squideyes.com)
//
// This file is part of SquidEyes.Trading
//
// The use of this source code is licensed under the terms
// of the MIT License (https://opensource.org/licenses/MIT)
// ********************************************************

using FluentAssertions;
using SquidEyes.Trading.Context;
using SquidEyes.Trading.Indicators;
using SquidEyes.UnitTests.Testing;
using Xunit;

namespace SquidEyes.UnitTests.Indicators;

public class DemaIndicatorTests
{
    [Fact]
    public void DemaIndicatorBaseline()
    {
        var results = new double[]
        {
            1.11663997, 1.11659702, 1.11650588, 1.11635642, 1.11624723, 1.11617192,
            1.11611218, 1.11610713, 1.11608964, 1.11607265, 1.11606251, 1.11601103,
            1.11600165, 1.11610936, 1.11619074, 1.11633445, 1.11641430, 1.11653539,
            1.11659048, 1.11659627, 1.11661516, 1.11657769, 1.11645255, 1.11632604,
            1.11633502, 1.11643475, 1.11642600, 1.11647216, 1.11654234, 1.11661005,
            1.11665901, 1.11664092, 1.11668895, 1.11670660, 1.11666528, 1.11657397,
            1.11653552, 1.11648382, 1.11641272, 1.11636404, 1.11634887, 1.11633544,
            1.11629023, 1.11624473, 1.11623233, 1.11621799, 1.11619886, 1.11621253,
            1.11625697, 1.11630403, 1.11630300, 1.11630253, 1.11633222, 1.11643698,
            1.11651746, 1.11653967, 1.11657474, 1.11660927, 1.11659376, 1.11659084,
            1.11665365, 1.11669889, 1.11673086, 1.11680247, 1.11689000, 1.11696250,
            1.11703010, 1.11697819, 1.11693059, 1.11690332, 1.11689157, 1.11679904,
            1.11670672, 1.11666486, 1.11661123, 1.11659214, 1.11652607, 1.11645189,
            1.11639854, 1.11634103, 1.11630051, 1.11624296, 1.11623574, 1.11627901,
            1.11631954, 1.11633117, 1.11635083, 1.11637289, 1.11639647, 1.11641104,
            1.11638574, 1.11637061, 1.11633994, 1.11627149, 1.11623816, 1.11622783,
            1.11621139, 1.11614414, 1.11602955, 1.11591352, 1.11586647, 1.11590056,
            1.11593163, 1.11587735, 1.11586225, 1.11592245, 1.11596863, 1.11599729,
            1.11609524, 1.11614808, 1.11616697, 1.11614072, 1.11625634, 1.11628494,
            1.11632473, 1.11635949, 1.11642344, 1.11647243, 1.11653324, 1.11653316,
            1.11654426, 1.11658690, 1.11654382, 1.11659618, 1.11673911, 1.11674360,
            1.11676102, 1.11678489, 1.11685327, 1.11699084, 1.11714935, 1.11742506,
            1.11768383, 1.11779977, 1.11787540, 1.11792784, 1.11790712, 1.11796179,
            1.11802975, 1.11826631, 1.11854113, 1.11874723, 1.11885520, 1.11909196,
            1.11922195, 1.11924277, 1.11938487, 1.11950797, 1.11973259, 1.11978400,
            1.11969071, 1.11977897, 1.11976766, 1.11977900, 1.11979458, 1.11979394,
            1.11987106, 1.12002581, 1.12017150, 1.12015132, 1.12016058, 1.12023517,
            1.12037154, 1.12038146, 1.12035731, 1.12037464, 1.12043963, 1.12044082,
            1.12033881, 1.12019087, 1.12005976, 1.11994221, 1.11985552, 1.11982872,
            1.11979696, 1.11971861, 1.11973495, 1.11974539, 1.11972145, 1.11974142,
            1.11980696, 1.11978351, 1.11963777, 1.11955415, 1.11952055, 1.11952416,
            1.11956177, 1.11966394, 1.11977022, 1.11978614, 1.11982072, 1.11980950,
            1.11983370, 1.11977177, 1.11968926, 1.11965159, 1.11956484, 1.11952147,
            1.11947423, 1.11930855, 1.11917160, 1.11900051, 1.11881488, 1.11860285,
            1.11852432, 1.11849209, 1.11848070, 1.11844131, 1.11834778, 1.11843566,
            1.11852503, 1.11849215, 1.11840460, 1.11838586, 1.11849080, 1.11859739,
            1.11856537, 1.11849645, 1.11835423, 1.11841627, 1.11842452, 1.11846196,
            1.11851736, 1.11856248, 1.11859623, 1.11862127, 1.11864295, 1.11867520,
            1.11870853, 1.11883504, 1.11898039, 1.11918178, 1.11931126, 1.11934699,
            1.11933960, 1.11936343, 1.11932805, 1.11929550, 1.11928872, 1.11938077,
            1.11940036, 1.11941578, 1.11944143, 1.11945495, 1.11952563, 1.11956253,
            1.11958747, 1.11962011, 1.11967832, 1.11968594, 1.11960324, 1.11948066,
            1.11939561, 1.11935237, 1.11928763, 1.11919414, 1.11914264, 1.11914578,
            1.11904390, 1.11896366, 1.11889001, 1.11887771, 1.11884807, 1.11891788,
            1.11896170, 1.11895922, 1.11896521, 1.11900375, 1.11901325, 1.11901420,
            1.11903187, 1.11901885, 1.11902274, 1.11903254, 1.11910610, 1.11919680,
            1.11924673, 1.11930571, 1.11935129, 1.11937348, 1.11938491, 1.11942811,
            1.11947493, 1.11951107, 1.11956564, 1.11967671, 1.11973002, 1.11975677
        };

        var indicator = new DemaIndicator(
            10, Known.Pairs[Symbol.EURUSD], RateToUse.Close);

        var candles = IndicatorData.GetCandles();

        candles.Count.Should().Be(results.Length);

        for (var i = 0; i < candles.Count; i++)
        {
            indicator.AddAndCalc(candles[i]).Value
                .Should().BeApproximately(results[i], 8);
        }
    }
}