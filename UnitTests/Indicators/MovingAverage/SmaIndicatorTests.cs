// ********************************************************
// Copyright (C) 2021 Louis S. Berman (louis@squideyes.com)
//
// This file is part of SquidEyes.Trading
//
// The use of this source code is licensed under the terms
// of the MIT License (https://opensource.org/licenses/MIT)
// ********************************************************

using FluentAssertions;
using SquidEyes.Trading.Context;
using SquidEyes.Trading.Indicators;
using SquidEyes.UnitTests.Testing;
using Xunit;

namespace SquidEyes.UnitTests.Indicators
{
    public class SmaIndicatorTests
    {
        [Fact]
        public void SmaIndicatorBaseline()
        {
            var results = new double[]
            {
                1.11663997, 1.11657500, 1.11649334, 1.11639002, 1.11632802, 1.11628836,
                1.11625717, 1.11624752, 1.11623446, 1.11622201, 1.11616901, 1.11611501,
                1.11608701, 1.11611800, 1.11614900, 1.11620399, 1.11625298, 1.11630999,
                1.11636199, 1.11640599, 1.11645499, 1.11650299, 1.11651399, 1.11648099,
                1.11647899, 1.11647999, 1.11646399, 1.11644499, 1.11644700, 1.11646399,
                1.11647599, 1.11648699, 1.11654599, 1.11660999, 1.11662699, 1.11659799,
                1.11660298, 1.11658498, 1.11654598, 1.11650298, 1.11646599, 1.11644399,
                1.11639199, 1.11634098, 1.11631199, 1.11629900, 1.11627400, 1.11626400,
                1.11627400, 1.11628700, 1.11628300, 1.11628000, 1.11629699, 1.11634300,
                1.11638399, 1.11641599, 1.11645700, 1.11649300, 1.11650701, 1.11652000,
                1.11656400, 1.11660800, 1.11664300, 1.11666800, 1.11670300, 1.11675200,
                1.11680000, 1.11681501, 1.11684000, 1.11686500, 1.11687300, 1.11685600,
                1.11683201, 1.11680101, 1.11675202, 1.11670601, 1.11663902, 1.11659402,
                1.11655102, 1.11649902, 1.11644402, 1.11640501, 1.11638300, 1.11636701,
                1.11636000, 1.11634099, 1.11634099, 1.11635100, 1.11636299, 1.11637999,
                1.11638600, 1.11640201, 1.11640201, 1.11637400, 1.11634901, 1.11633401,
                1.11631300, 1.11627300, 1.11621100, 1.11614000, 1.11609099, 1.11606098,
                1.11603799, 1.11600499, 1.11597400, 1.11595999, 1.11594899, 1.11595299,
                1.11600000, 1.11605101, 1.11608500, 1.11608701, 1.11612900, 1.11617800,
                1.11622599, 1.11625500, 1.11629601, 1.11634001, 1.11636901, 1.11639100,
                1.11642301, 1.11647800, 1.11647000, 1.11650500, 1.11656600, 1.11659501,
                1.11661700, 1.11664200, 1.11667500, 1.11674800, 1.11683500, 1.11696000,
                1.11712500, 1.11724300, 1.11732801, 1.11744401, 1.11753901, 1.11765301,
                1.11776102, 1.11790001, 1.11805301, 1.11816001, 1.11823801, 1.11838701,
                1.11852601, 1.11864400, 1.11881900, 1.11897900, 1.11917200, 1.11927500,
                1.11930901, 1.11939001, 1.11946101, 1.11949000, 1.11953400, 1.11959600,
                1.11964201, 1.11971101, 1.11974800, 1.11978000, 1.11985800, 1.11990800,
                1.12000500, 1.12006800, 1.12011900, 1.12018400, 1.12024101, 1.12025400,
                1.12022601, 1.12021401, 1.12018701, 1.12013201, 1.12005100, 1.12000700,
                1.11996701, 1.11989801, 1.11983401, 1.11978201, 1.11975000, 1.11975000,
                1.11977099, 1.11977600, 1.11974200, 1.11970400, 1.11967800, 1.11967700,
                1.11966399, 1.11967399, 1.11970299, 1.11970199, 1.11969299, 1.11969500,
                1.11974599, 1.11976600, 1.11976699, 1.11976699, 1.11973900, 1.11969500,
                1.11963700, 1.11955800, 1.11946701, 1.11936500, 1.11923400, 1.11910300,
                1.11900501, 1.11890601, 1.11882701, 1.11873101, 1.11861900, 1.11859300,
                1.11857799, 1.11855400, 1.11852900, 1.11854100, 1.11856600, 1.11859300,
                1.11858400, 1.11857200, 1.11855299, 1.11853800, 1.11850500, 1.11851200,
                1.11854700, 1.11856999, 1.11855799, 1.11853799, 1.11855298, 1.11858698,
                1.11865199, 1.11869799, 1.11877199, 1.11886599, 1.11894699, 1.11901000,
                1.11906400, 1.11912800, 1.11917601, 1.11921802, 1.11926302, 1.11930702,
                1.11932101, 1.11930702, 1.11930301, 1.11931502, 1.11935501, 1.11938101,
                1.11942201, 1.11946900, 1.11952100, 1.11953299, 1.11953299, 1.11951399,
                1.11949199, 1.11947699, 1.11943299, 1.11937898, 1.11932998, 1.11928798,
                1.11920298, 1.11912599, 1.11906999, 1.11904399, 1.11900899, 1.11899500,
                1.11898800, 1.11898400, 1.11897700, 1.11896800, 1.11898500, 1.11900200,
                1.11902899, 1.11903598, 1.11905398, 1.11904699, 1.11906298, 1.11910099,
                1.11913199, 1.11916000, 1.11919500, 1.11922899, 1.11925700, 1.11930400,
                1.11935199, 1.11939899, 1.11943499, 1.11948199, 1.11952599, 1.11955999
            };

            var indicator = new SmaIndicator(
                10, Known.Pairs[Symbol.EURUSD], RateToUse.Close);

            var candles = IndicatorData.GetCandles();

            candles.Count.Should().Be(results.Length);

            for (var i = 0; i < candles.Count; i++)
            {
                indicator.AddAndCalc(candles[i]).Value
                    .Should().BeApproximately(results[i], 8);
            }
        }
    }
}